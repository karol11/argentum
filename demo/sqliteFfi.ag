using sys { String, Blob }

class Sqlite {
    internal = 0;
    open(fileName -String, flags int) ?Sqlite;
    query(sql -String, flags int) Query {
        r = Query;
        internalQuery(r, sql, flags);
        r
    }
    internalQuery(q Query, sql -String, flags int);
}
fn afterCopySqlite(c Sqlite) { c.internal := 0; }
fn onDisposeSqlite(c Sqlite);

class Row{
    internal = 0;
    intAt(at int) int;
    doubleAt(at int) double;
    stringAt(at int) String;
    blobAt(at int, result Blob);
}
fn afterCopyRow(r Row) { r.internal := 0; }
fn onDisposeRow(r Row);

class Query {
    +Row;
    setString(at int, val -String) this;
    setInt(at int, val int) this;
    setBlob(at int, val int) this;
    execute(onRow(Row)) {
        loop (internalStep() ? onRow(this))
    }
    internalStep() bool;
}
