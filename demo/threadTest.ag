using sys { Object, Array, String, Thread, log, setMainObject }
using utils { forRange }
using array;
using string;
const CR = utf32_(10);

class App{
    threads = Array(Thread(Object));
    activeCount = 0;
}
app = App;
setMainObject(app);
app.threads.push(20) {
    log("Launch thread {app.threads.size()}{CR}");
    thread = Thread(Object).start(Object);
    thread.root().&myTask(tNum int, then &()){
        forRange(0, 100) i {
            log("Thread {tNum} iteration {i}{CR}");
        };
        then~();
    }~(app.activeCount += 1, app.&finishThread(){
        activeCount -= 1;
        log("{activeCount} threads left{CR}");
        activeCount == 0 ? setMainObject(?Object);
    });
    thread
}